# 认证和授权 Authentication & Authorization

## 简介

### 概述

**认证**

+ 你是谁

**授权**

+ 你有权限干什么

### RBAC 模型 Role-Based Acess Control

**描述**

+ 这是一种角色关联权限，角色同时又关联用户的授权的方式。

+ 简单来说：一个用户可以拥有若干角色，每一个角色又可以被分配若干权限，这样就构造成“用户-角色-权限” 的授权模型。
  - 在这种模型中，用户与角色、角色与权限之间构成了多对多的关系。

## 技术

### HTTP Basic Authentication

**简介**

+ 这种授权方式是浏览器遵守HTTP协议实现的基本授权方式。
+ HTTP协议进行通信的过程中，HTTP协议定义了基本认证认证允许HTTP服务器对客户端进行用户身份证的方法。

### Cookie + Session

#### Cookie

**描述**

+ cookie是浏览器保存在用户电脑上的一小段文本。

**作用**

+ 会话状态管理（如用户登录状态、购物车、游戏分数或其它需要记录的信息）；
+ 个性化设置（如用户自定义设置、主题等）；
+ 浏览器行为跟踪（如跟踪分析用户行为等）。

#### Session

**描述**

+ Session是一种被成为“会话控制”的计算机网络技术。

**作用**

+ Session技术能够利用==Session对象==存储特定用户会话所需的属性及配置信息。

#### 流程

+ 用户向服务器发送用户名、密码、验证码用于登陆系统。
+ 服务器验证通过后，服务器为用户创建一个 `Session`，并将 `Session` 信息存储起来。
+ 服务器向用户返回一个 `SessionID`，写入用户的 `Cookie`。
+ 当用户保持登录状态时，`Cookie` 将与每个后续请求一起被发送出去。
+ 服务器可以将存储在 `Cookie` 上的 `SessionID` 与存储在内存中或者数据库中的 `Session` 信息进行比较，以验证用户的身份，返回给用户客户端响应信息的时候会附带用户当前的状态。

#### 问题

**描述**

+ 多服务器Cookie - Session鉴权方式怎么实现？
+ 没有Cookie 还能使用Session鉴权吗？

**解决**

+ 对于问题1，可以有一下几种解决方案：

  - 某个用户的所有请求都通过特性的哈希策略分配给同一个服务器处理。

  - 每一个服务器保存的 Session 信息都是互相同步的，也就是说每一个服务器都保存了全量的 Session 信息。
  - 单独使用一个所有服务器都能访问到的数据节点（比如缓存）来存放 Session 信息。为了保证高可用，数据节点尽量要避免是单点。

+ 对于问题2，并不是没有 `Cookie` 之后就不能用 `Session` 了，比如你可以将 `SessionID` 放在请求的 `url` 里面`https://javaguide.cn/?Session_id=xxx` 。这种方案的话可行，但是安全性和用户体验感降低。

### Token & JWT

#### 简介

+ 令牌Token是指服务器为客户端颁发的一种授权凭证。

+ JWT 全称 JSON Web Tokens ，是一种规范化的 token。可以理解为对 token 这一技术提出一套规范，是在 **RFC 7519** 中提出的。

### 流程

+ 客户端使用用户名跟密码请求登录
+ 服务端收到请求，去验证用户名与密码
+ 验证成功后，服务端会签发一个`Token`，再把这个`Token`发送给客户端
+ 客户端收到`Token`以后可以把它存储起来，比如放在`Cookie`里或者`Local Storage`里
+ 客户端每次向服务端请求资源的时候需要带着服务端签发的`Token`
+ 服务端收到请求，然后去验证客户端请求里面带着的`Token`，如果验证成功，就向客户端返回请求的数据

### OAuth

#### 简介

+ OAuth 是一个行业的标准授权协议，主要用来授权第三方应用获取有限的权限。
+ 实际上它就是一种授权机制，它的最终目的是为第三方应用颁发一个有时效性的令牌 Token，使得第三方应用能够通过该令牌获取相关的资源。

## 参考

+ [认证和授权基础](https://javaguide.cn/system-design/security/basis-of-authority-certification.html#%E8%AE%A4%E8%AF%81-authentication-%E5%92%8C%E6%8E%88%E6%9D%83-authorization-%E7%9A%84%E5%8C%BA%E5%88%AB%E6%98%AF%E4%BB%80%E4%B9%88)
+ [四种常见鉴权方式说明](https://blog.51cto.com/u_14785218/2878553)
+ [聊聊鉴权那些事](https://segmentfault.com/a/1190000020146855)