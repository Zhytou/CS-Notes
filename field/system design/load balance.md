# 负载均衡、反向代理和网关

- [负载均衡、反向代理和网关](#负载均衡反向代理和网关)
  - [负载均衡](#负载均衡)
    - [负载均衡算法：随机和轮询](#负载均衡算法随机和轮询)
    - [一致性哈希算法](#一致性哈希算法)
  - [反向代理](#反向代理)
    - [使用反向代理的意义](#使用反向代理的意义)
  - [网关](#网关)
  - [参考](#参考)

## 负载均衡

负载均衡（Load Balance）是一种计算机网络技术。它用于将网络流量分发到多个服务器上，以实现服务器资源的最大化利用，从而提高整体系统的吞吐量和可用性。常见的负载均衡例子包括：

- **DNS负载均衡**：在DNS中为多个地址配置同一个名字，因而查询这个名字的客户机将得到其中一个地址，从而使得不同的客户访问不同的服务器，达到负载均衡的目的。
- **NAT负载均衡**：NAT负载均衡是通过NAT设备实现的一种负载均衡技术。在网络中，NAT设备将内部网络的IP地址映射到外部网络的IP地址，从而允许内部网络中的多台主机共享一个或少量的公共IP地址，进而保证将外部连接请求分发给不同的内部服务器。
- **CDN负载均衡**：CDN通过在全球各地部署多个节点服务器，将用户请求分发到距离用户最近的服务器上，从而降低网络延迟，提高内容传输速度和可靠性。

### 负载均衡算法：随机和轮询

### 一致性哈希算法

除了随机和轮询之外，一致性哈希也是一种重要的负载均衡算法。不过和前两者不同，它并不是希望请求尽可能将均匀地派发到服务器中从而实现最多加权实现，而是用于使特定用户请求总是派发到特定服务器中。

**普通负载均衡算法和普通哈希算法的局限**：

有些时候，我们希望将请求均匀的派送到不同服务器上，但普通的负载均衡算法（如：轮询和随机）显然难以做到这一点。此时，我们就需要使用哈希算法来保证，但是传统的哈希算法（如：hash(x)=x%n）这种形式受服务器节点数量影响。当服务节点发生变化时，所有数据可能都需要重新哈希并重新分布到不同节点上，导致之前缓存在各节点的数据全部失效。因此，就提出了普通哈希算法的改进版本——一致性哈希算法。

**虚拟阶段和哈希环**：

一致性哈希算法通过构建一个环形空间，将节点均匀分布在环上，并为每个节点创建多个虚拟节点，从而实现了在节点变化时只需重新映射环上相邻的少量数据，避免了传统哈希算法可能带来的缓存失效和数据分布不均的问题。

## 反向代理

反向代理（Reverse Proxy）是一种可以集中地调用内部服务，并提供统一接口给公共客户的Web服务器。

### 使用反向代理的意义

- **增加安全性**：隐藏后端服务器的信息，屏蔽黑名单中的 IP，限制每个客户端的连接数。
- **提高可扩展性和灵活性**：客户端只能看到反向代理服务器的 IP，这使你可以增减服务器或者修改它们的配置。
- **终结SSL会话**：解密传入请求，加密服务器响应，这样后端服务器就不必完成这些潜在的高成本的操作。
- **直接提供静态内容**：直接提供HTML/CSS/JS、图片和视频等资源。

尽管使用反向代理有一系列好处，但在系统中引入它也同样会增加增加系统的复杂度。甚至有时为了避免发生单点故障，可能会配置多台反向代理服务器从而导致进一步增加复杂度。

## 网关

在实际应用中，负载均衡、反向代理和网关通常会结合在一起实现。负载均衡主要负责将请求分发到多个服务器，反向代理可以用于隐藏后端服务器、缓存静态内容、SSL 终结等，网关则负责协议转换、安全检查等。

这三者结合起来可以提供更全面的网络安全、性能优化和可伸缩性。例如，常见的负载均衡器如Nginx和HAProxy就同时支持负载均衡、反向代理和网关功能。

## 参考

- [system-design-primer](https://github.com/donnemartin/system-design-primer)
- [How does a load balancer distribute client traffic across severs?](https://kemptechnologies.com/load-balancer/load-balancing-algorithms-techniques/)
- [负载均衡](https://baike.baidu.com/item/%E8%B4%9F%E8%BD%BD%E5%9D%87%E8%A1%A1/932451?fr=aladdin)
- [什么是负载均衡原理](https://www.zhihu.com/question/61783920)
- [负载均衡调度算法大全](https://www.runoob.com/w3cnote/balanced-algorithm.html)
