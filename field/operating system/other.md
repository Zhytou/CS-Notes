# 其他

- [其他](#其他)
  - [系统调用](#系统调用)
  - [计算机的启动](#计算机的启动)
    - [引导程序 Bootloader](#引导程序-bootloader)
    - [固件 Firmware](#固件-firmware)
  - [标准C库](#标准c库)
  - [参考](#参考)

## 系统调用

**进程的空间**：

操作系统将物理内存划分为用户空间和内核空间。

> 操作系统内核是操作系统的核心部分，它是位于操作系统最底层的软件组件，主要负责管理计算机硬件和提供基本系统服务，例如进程管理、内存管理、文件系统管理、设备驱动程序等。
> 操作系统内核通常是一个庞大的软件系统，由多个模块构成，每个模块实现不同的功能。常见的操作系统内核类型包括：宏内核、微内核和混合内核。

**系统调用**：

为了使用户进程能够使用操作系统更底层的功能，内核会暴露出一些接口以供它们使用。

为了保证操作系统的稳定和安全，内核依据由CPU提供的、可以让进程驻留的特权级别建立了两种特权状态，即；内核态和用户态。

当CPU处于用户态时，只能对用户空间访问；当CPU处于用户态时，能对用户空间和内核空间访问。

因此，当用户进程发起一个系统调用时，CPU会从用户态切换至内核态，再执行完相应的内核操作后，再切换回用户态。

## 计算机的启动

![图1 计算机启动流程](https://scaler.com/topics/images/what-is-bootloader-image1.webp)

一般来说，当电脑启动时，它所执行的是预先写死在ROM中的指令，从而完成配置硬件、加载操作系统等一系列操作。引导计算机启动操作系统的一系列程序被我们称为引导程序。通常，我们可以根据启动顺序，把引导程序大致分为两类：初级引导程序和二级引导程序。

### 引导程序 Bootloader

**First-stage boot loader**：

常见的初级引导程序包括：BIOS和UFEI等。它们负责硬件初始化，并加载更高级别的引导程序。同时，它还提供硬件自检测、设置启动设备顺序等一系列功能。

以BIOS为例，当电脑启动时，BIOS首先执行加电自检（Power-On Self-Test，POST），测试和初始化CPU、RAM等硬件，接着按照"启动顺序"，把控制权转交给排在第一位的储存设备。这时，计算机读取该设备的第一个扇区，也就是读取最前面的512个字节，即：主引导记录（Master boot record，MBR）。如果这512个字节的最后两个字节是0x55和0xAA，表明这个设备可以用于启动；如果不是，表明设备不能用于启动，控制权于是被转交给"启动顺序"中的下一个设备。根据MBR中的分区记录，计算机会找到二级引导程序，并由它来加载操作系统内核。

**Second-stage boot loader**：

常见的第二阶段引导加载程序包括：GNU GRUB、rEFInd、BOOTMGR、Syslinux、NTLDR等。它们本身不是操作系统，但能够正确加载操作系统并将执行转移给它。

### 固件 Firmware

固件是一种嵌入在硬件设备中的软件。它通常是位于特殊应用集成电路或可编程逻辑器件之中的闪存或ROM，有的可以让用户更新。计算机的常见固件包括：BIOS和UEFI，与其对应的是两种分区以及引导方式：MBR分区表对应BIOS（Legacy）启动和GPT分区表对应UEFI启动。值得一提的是，前者目前已经逐渐被后者取代。

**磁盘分区**：

传统Legacy BIOS模式下主要使用MBR(主引导记录)分区方式:

- MBR分区是一种较老的分区方式，最多只能定义4个主分区
- 如需创建更多分区，需要使用扩展分区，扩展分区下再划分逻辑分区
- MBR分区表存储在磁盘的前64字节中
- 硬盘容量不能超过2TB

相比之下，UEFI(统一可扩展固件接口)模式下使用了GPT(GUID分区表)分区方式:

- GPT分区是较新的分区方式，支持硬盘容量超过2TB
- 理论上可以定义无数个主分区，没有逻辑分区概念
- GPT分区表占用33个扇区的空间，比MBR大得多
- GPT提供了更好的容错能力和磁盘空间利用率

需要注意的是，MBR和BIOS、GPT和UEFI并非绑定的关系，只是新旧配对方式不同。BIOS系统仍然可以使用GPT分区方式，只是BIOS无法直接启动GPT磁盘。同样UEFI系统也可以使用传统的MBR分区。

## 标准C库

## 参考
