# 常量与字面量

- [常量与字面量](#常量与字面量)
  - [常量](#常量)
    - [marco](#marco)
    - [const](#const)
    - [constexpr](#constexpr)
  - [字面量](#字面量)
    - [整型字面量](#整型字面量)
    - [浮点型字面量](#浮点型字面量)
    - [字符字面量](#字符字面量)
    - [字符串字面量](#字符串字面量)
    - [自定义字面量](#自定义字面量)

## 常量

在C/C++语言中，有两种简单的定义常量的方式：

- 使用#define预处理指令定义一个宏： #define可以在程序中定义一个常量，它在编译时会被替换为其对应的值。
- 使用const关键字：const 关键字用于声明一个只读变量，即该变量的值不能在程序运行时修改。

### marco

宏（Macro）是一种在编程中用来进行代码替换的预处理指令。宏定义了一段代码片段，可以在程序中多次使用，并且在编译阶段通过预处理器进行替换。除了可以使用宏定义常量之外，我们还可以定义一些简单的函数。

```c++
#define PI 3.14159
#define MAX(a, b) ((a) > (b) ? (a) : (b))
```

尽管宏定义常量和函数非常方便，但我们仍然跟偏向于使用const定义常量和constexpr定义函数来替代宏机制。因为宏只进行替换，不能进行类型检查，同时也无法限制其作用域。

### const

const变量在声明时可以选择进行初始化也可以选择不进行初始化。值得注意的是，如果不进行初始化，则无法在后续的代码中给它赋值。

**指针与const**：

顶层`const`表示指针本身是个常量。

``` c++
int i  = 1;
int *const p = &i;//p将一直指向i，即顶层const
```

底层`const`表示指针所指对象是个常量。

``` c++
const int *p = 1;//p是一个指向常量的指针，即底层const
```

**成员变量与const**：

值得注意的是，初始化const成员变量只有一种方法，就是通过构造函数的初始化列表。而static成员变量则是在类外初始化。

**成员函数与const**：

可以将`const`放在参数列表之后来修饰`this`指针，从而保障`const`变量也能调用该成员函数。

### constexpr

constexpr用于声明可在编译时求值的常量表达式，其值在编译时确定。

其实，const并不能代表“常量”，它仅仅是对变量的一个修饰，告诉编译器这个变量只能被初始化，且不能被直接修改（实际上可以通过堆栈溢出等方式修改）。而这个变量的值，可以在运行时也可以在编译时指定。

constexpr可以用来修饰变量、函数、构造函数。一旦以上任何元素被constexpr修饰，那么等于说是告诉编译器 “请大胆地将我看成编译时就能得出常量值的表达式去优化我”。

## 字面量

在编程语言中，字面量（Literals）是用于表示数据的固定值或常量。字面量可以直接在代码中使用，而不需要进行计算或求值。下面分别介绍一些常用的字面量。

### 整型字面量

通过添加`0b`、`0`、`0x`等前缀说明数字的进制：

- `0b`或`0B`表示二进制
- `0`表示八进制
- 无前缀表示十进制
- `0x`或`0X`表示十六进制

通过添加`U`、`L`等后缀说明数字的类型：

- int：无后缀
- unsigned int：`u`或`U`
- long int：`l`或`L`
- unsigned long int：`ul`或`UL`
- long long int：`ll`或`LL`
- unsigned long long int：`ull`或`ULL`

### 浮点型字面量

浮点型字面量分为两种表示方法：

- 小数点形式：必须包含整数部分、小数部分，或同时包含两者
- 指数形式：必须包含小数点、指数，或同时包含两者。

此外，浮点型字面量还可以使用后缀`f`或`F`表示常量为float类型，无后缀表示double类型。

### 字符字面量

字符字面量使用前缀区分存储类型：

- 无前缀：char类型
- 有`L`或`l`前缀：wchar_t类型
- 有`u`前缀：char16_t类型
- 有`U`前缀：char32_t类型

### 字符串字面量

字符串字面量与字符字面量类似，也是很通过前缀区分存储类型：

- 无前缀：char类型
- 有`L`或`l`前缀：wchar_t类型
- 有`u`前缀：char16_t类型
- 有`U`前缀：char32_t类型

### 自定义字面量

除了上面提到的几种字面量之外，C++11还引入了一种称为用户自定义字面量（User-Defined Literals）的机制。它允许程序员定义自己的字面量形式，以扩展语言的表达能力。

一般来说，用户自定义字面量由两部分组成：字面量运算符（Literal Operator）和字面量标识符（Literal Identifier）。

- 字面量运算符是一个重载的函数，用于处理自定义字面量的解释和计算。它以特殊的形式出现在字面量之后，可以是后缀形式或原生形式。
- 字面量标识符是一个标识符，用于标识自定义字面量的类型和含义。

下面是一个使用自定义字面量进行单位转换的例子。

``` c++
//User defined literals
constexpr long double operator"" _cm(long double x) {return x * 10; }
constexpr long double operator"" _m(long double x) {return x * 1000; }
constexpr long double operator"" _mm(long double x) {return x; }

int main() {
    long double height = 3.4_cm;
    cout << (height + 13.0_m) << endl;
    cout << (130.0_mm / 13.0_m) << endl;
}
```
