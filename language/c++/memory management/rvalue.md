# 右值：移动和转发

- [右值：移动和转发](#右值移动和转发)
  - [右值](#右值)
  - [移动语义](#移动语义)
    - [右值引用](#右值引用)
    - [移动构造](#移动构造)
    - [std::move](#stdmove)
  - [完美转发](#完美转发)
    - [std::forward](#stdforward)

## 右值

在C++语言中，所有具有名字的对象或变量都是左值(lvalue)，而**不可寻址**临时对象或字面量等则被视为右值(rvalue)。实际上，右值分成两种：

- 纯右值(prvalue，pure right value):是一种临时的、无需标识的右值，例如字面值常量、临时对象等。
- 将亡值(xvalue，expiring value):是一种即将被销毁、但仍然可以访问其内部成员的右值。通常是通过 std::move 转换得到的。

## 移动语义

移动语义(move semantics)是C++11引入的一个重要特性，旨在提高对临时对象的效率。通过移动语义，可以将临时对象的资源（如内存所有权）转移给另一个对象，而无需进行深层次的复制操作。

### 右值引用

为了支持移动操作，C++11引入了一种新的引用类型——右值引用(rvalue reference)，即绑定到右值的引用。为了和其区分开来，可以将C++98中的普通引用称之为左值引用(lvalue reference)。

类似左值引用，一个右值引用也不过是某个对象的另一个名字而已。不过因为右值总是没有名字，所以往往只能通过其引用找到它。

除此之外，右值引用还有一个重要的性质，即只能绑定到将亡右值上。因此，我们不能将其绑定到要求转化的表达式、字面常量或是返回右值的表达式。

### 移动构造

在C++中，一个对象通常可以通过构造函数和赋值运算符进行初始化。其中，移动构造函数和移动赋值运算符是用于实现移动语义的重要工具。移动构造函数接受一个右值引用作为参数，用于接管另一个对象的资源，并将其销毁。移动赋值运算符也是类似的，用于在赋值时将右值的资源转移到左值。

### std::move

我们还可以通过调用一个名为`std::move`的新标准函数来获得绑定到左值上的右值引用。我们必须认识到，调用`move`就意味着承诺，除了对这个左值引用赋值或销毁它外，我们将不再使用它。

## 完美转发

当一个右值引用作为函数的形参时，在函数内部再使用该参数时它已经变成一个左值了。因此，我们需要一种方法能按照参数原来的类型转发到另一函数，这种转发被称为完美转发，即：在模板函数中，完全依照模板参数类型，将参数传递给另一个函数。

### std::forward

C++标准库定义了std::forward函数来保证实现完美转发。具体来说，std::forward的功能是：当参数不是一个左值引用时，函数返回一个右值引用；当参数是一个左值引用时，函数什么都不修改直接返回。
